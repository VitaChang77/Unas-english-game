<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹å°å››å¹´ç´šè‹±æ–‡å–®å­—å¤§æŒ‘æˆ°</title>
    <style>
        body {
            font-family: 'Comic Sans MS', 'Microsoft JhengHei', sans-serif;
            background-color: #f0f8ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 5px; }
        
        .container {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 100%;
            text-align: center;
            position: relative;
        }

        /* é¡Œåº«é¸æ“‡å™¨ */
        .category-selector {
            margin-bottom: 20px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 10px;
            border: 2px solid #90caf9;
        }
        select {
            padding: 8px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ccc;
            width: 100%;
            font-family: 'Microsoft JhengHei', sans-serif;
            cursor: pointer;
        }

        .mode-switch { margin-bottom: 20px; }
        .mode-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
        }
        .mode-btn:hover { transform: scale(1.05); }
        .mode-btn.active { background-color: #2E8B57; border: 2px solid #fff; box-shadow: 0 0 5px rgba(0,0,0,0.2); }
        
        .restart-btn { background-color: #FF9800; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-size: 18px; cursor: pointer; margin-top: 20px; }
        
        .speak-btn {
            background-color: #2196F3;
            color: white; border: none; border-radius: 10px; cursor: pointer;
            font-size: 18px;
            padding: 10px 25px;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* å–®å­—å¡æ¨£å¼ */
        .card {
            background: #ffeb3b;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            font-size: 28px;
            margin: 20px 0;
            cursor: pointer;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            user-select: none;
            word-wrap: break-word;
        }
        .card:active { transform: scale(0.95); }

        /* --- æ‹¼å­—æ¨¡å¼ UI --- */
        .input-group { margin: 20px 0; }
        input[type="text"] {
            padding: 15px;
            font-size: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            width: 70%;
            text-align: center;
        }
        .hint-btn {
            background-color: #FFC107;
            color: #333;
            font-weight: bold;
            margin-top: 10px;
            border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;
        }
        .hint-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        .hint-display { color: #E65100; font-weight: bold; font-size: 20px; min-height: 30px; margin-top: 5px; }
        .submit-btn { background-color: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-size: 18px; }

        /* --- é¸æ“‡é¡Œ UI --- */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        .option-btn {
            background-color: #fff;
            border: 2px solid #2196F3;
            color: #333;
            padding: 20px 10px;
            font-size: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.2s;
            font-family: 'Comic Sans MS', sans-serif;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .option-btn:hover { background-color: #e3f2fd; transform: translateY(-2px); }
        .option-btn:active { transform: translateY(0); }
        .option-btn.correct { background-color: #4CAF50; color: white; border-color: #4CAF50; }
        .option-btn.wrong { background-color: #F44336; color: white; border-color: #F44336; opacity: 0.6; }

        /* é€šç”¨åé¥‹ */
        .feedback { min-height: 30px; margin-top: 15px; font-weight: bold; font-size: 18px; }
        .correct-text { color: green; }
        .wrong-text { color: red; }
        
        .quiz-status { display: flex; justify-content: space-between; font-size: 16px; color: #555; margin-bottom: 10px; font-weight: bold; }
        .hidden { display: none; }
        .result-screen { text-align: center; }
        .final-score { font-size: 48px; color: #E91E63; font-weight: bold; margin: 20px 0; }
        .nav-btn { background-color: #4CAF50; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 10px; cursor: pointer; font-size: 16px; }
    </style>
</head>
<body>

    <h1>ğŸŒŸ å–®å­—å¤§æŒ‘æˆ° ğŸŒŸ</h1>
    
    <div class="container">
        <div class="category-selector">
            <label for="category-select">ğŸ“š è«‹é¸æ“‡é¡Œåº«ï¼š</label>
            <select id="category-select" onchange="changeCategory()">
                <option value="week10_17">ğŸ“… ç¬¬10é€± ~ ç¬¬17é€± (æ¸¬é©—: é¸æ“‡é¡Œ)</option>
                <option value="food_fruit">ğŸ é£Ÿç‰©èˆ‡æ°´æœ (æ¸¬é©—: æ‹¼å­—ç·´ç¿’)</option>
            </select>
        </div>

        <div class="mode-switch">
            <button onclick="setMode('study')" id="btn-study" class="mode-btn active">ğŸ“– ç·´ç¿’æ¨¡å¼</button>
            <button onclick="setMode('quiz')" id="btn-quiz" class="mode-btn">ğŸ® æ¸¬é©—æ¨¡å¼</button>
        </div>

        <div id="study-area">
            <div style="color:#888; font-size:14px;">æœ¬å€å–®å­—æ•¸: <span id="current-word-num">1</span> / <span id="total-words"></span></div>
            <div class="card" onclick="flipCard()" id="flashcard">
                è¼‰å…¥ä¸­...
            </div>
            <button onclick="speakCurrentWord()" class="speak-btn">ğŸ”Š è½ç™¼éŸ³</button>
            <br><br>
            <button onclick="prevCard()" class="nav-btn" style="background-color: #999;">â¬…ï¸ ä¸Šä¸€å€‹</button>
            <button onclick="nextCard()" class="nav-btn">ä¸‹ä¸€å€‹ â¡ï¸</button>
        </div>

        <div id="quiz-area" class="hidden">
            <div id="quiz-playing">
                <div class="quiz-status">
                    <span>é¡Œç›®: <span id="q-progress">1</span> / <span id="q-total">10</span></span>
                    <span>å¾—åˆ†: <span id="score">0</span></span>
                </div>
                
                <div class="card" style="background: #e0f7fa; cursor: default; margin-bottom: 10px;">
                    <span id="quiz-question">é¡Œç›®</span>
                </div>
                
                <div id="ui-spelling" class="hidden">
                    <div style="color: #666; font-size: 14px;">è«‹è¼¸å…¥è‹±æ–‡å–®å­—ï¼š</div>
                    <div class="input-group">
                        <input type="text" id="answer-input" placeholder="è¼¸å…¥è‹±æ–‡..." autocomplete="off">
                    </div>
                    <button onclick="useHint()" id="btn-hint" class="hint-btn">ğŸ’¡ æç¤º (å‰©é¤˜: 5)</button>
                    <div id="hint-display" class="hint-display"></div>
                    <br>
                    <button onclick="checkSpellingAnswer()" class="submit-btn">é€å‡ºç­”æ¡ˆ âœ…</button>
                </div>

                <div id="ui-choice" class="hidden">
                    <div style="color: #666; font-size: 14px;">è«‹é»æ“Šæ­£ç¢ºçš„å–®å­—ï¼š</div>
                    <div class="options-grid" id="options-container">
                        </div>
                </div>
                
                <div class="feedback" id="feedback"></div>
            </div>

            <div id="quiz-result" class="hidden result-screen">
                <h2>ğŸ‰ æ¸¬é©—å®Œæˆï¼ ğŸ‰</h2>
                <div>ä½ çš„åˆ†æ•¸æ˜¯</div>
                <div class="final-score" id="final-score">100</div>
                <p id="comment">å¤ªå²å®³äº†ï¼</p>
                <button onclick="startNewQuizRound()" class="restart-btn">ğŸ”„ å†è€ƒä¸€æ¬¡</button>
            </div>
        </div>
    </div>

    <script>
        // --- è³‡æ–™åº«å€ ---
        const db_week10_17 = [
            { ch: "å¥½çš„", en: "nice" }, { ch: "è£½ä½œ", en: "make" }, { ch: "ç„¡å°¾ç†Š", en: "koala" },
            { ch: "å’Œ", en: "and" }, { ch: "è Ÿç­†", en: "crayon" }, { ch: "é¤æ¡Œ", en: "table" }, { ch: "è‚¥çš‚", en: "soap" }, 
            { ch: "æ¸¬é©—/è€ƒè©¦", en: "test" }, { ch: "å¿«æ¨‚çš„", en: "happy" }, { ch: "å‚·å¿ƒçš„", en: "sad" }, 
            { ch: "èœ¥èœ´", en: "lizard" }, { ch: "è´è¶", en: "butterfly" }, { ch: "çŸ³é ­", en: "stone" }, 
            { ch: "ç´«è‰²", en: "purple" }, { ch: "ç²‰ç´…è‰²", en: "pink" }, { ch: "å¥½çš„ (å¥åº·/å¤©æ°£)", en: "fine" }, 
            { ch: "èµ°", en: "go" }, { ch: "æ™šé¤", en: "dinner" }, { ch: "éŒ¢åŒ…", en: "purse" }, { ch: "æ¨è»Š", en: "cart" }, 
            { ch: "ç°è‰²", en: "gray" }, { ch: "æ¯å­", en: "cup" }, { ch: "çƒæ£’/è™è ", en: "bat" }, 
            { ch: "æ£’çƒå¸½", en: "cap" }, { ch: "å…¬è»Š", en: "bus" }, { ch: "æ·é‹", en: "MRT" }, { ch: "é«˜éµ", en: "HSR" }, 
            { ch: "çœ¼ç›", en: "eye" }, { ch: "è‡‰", en: "face" }, { ch: "å˜´å”‡", en: "lip" },
            { ch: "å¯µç‰©", en: "pet" }, { ch: "å·¥ä½œ", en: "work" }, { ch: "å˜´å·´", en: "mouth" }, { ch: "æ–å‹•", en: "shake" }, 
            { ch: "é ­é«®", en: "hair" }, { ch: "é¼»å­", en: "nose" }, { ch: "è€³æœµ", en: "ear" }, 
            { ch: "åœ¨...å¾Œ", en: "after" }, { ch: "é£²é£Ÿ/ç¯€é£Ÿ", en: "diet" }, { ch: "ç›¤å­", en: "plate" }, 
            { ch: "è–èª•ç¯€", en: "Christmas" }, 
            { ch: "é ­", en: "head" }, { ch: "æ¹¯", en: "soup" }, { ch: "èˆ‡...ä¸€èµ·", en: "with" }, 
            { ch: "æ©Ÿå™¨äºº", en: "robot" }, { ch: "æ´‹å¨ƒå¨ƒ", en: "doll" }, { ch: "æ¹¯åŒ™", en: "spoon" }, { ch: "å‰å­", en: "fork" },
            { ch: "è…³", en: "foot" }, { ch: "æ™‚é˜", en: "clock" }, { ch: "è­¦å¯Ÿ", en: "police officer" },
            { ch: "æ©¡çš®æ“¦", en: "eraser" }, { ch: "è† æ°´", en: "glue" }, { ch: "åˆ€å­", en: "knife" }
        ];

        const db_food_fruit = [
            { ch: "è›‹ç³•", en: "cake" }, { ch: "æ¼¢å ¡ (è¤‡æ•¸)", en: "hamburgers" },
            { ch: "ç†±ç‹— (è¤‡æ•¸)", en: "hot dogs" }, { ch: "å†°æ·‡æ·‹", en: "ice cream" },
            { ch: "æŠ«è–©", en: "pizza" }, { ch: "ç±³é£¯", en: "rice" },
            { ch: "ä¸‰æ˜æ²» (è¤‡æ•¸)", en: "sandwiches" },
            { ch: "è˜‹æœ (è¤‡æ•¸)", en: "apples" }, { ch: "é¦™è•‰ (è¤‡æ•¸)", en: "bananas" },
            { ch: "æŸ³æ©™ (è¤‡æ•¸)", en: "oranges" }, { ch: "è¥¿ç“œ (è¤‡æ•¸)", en: "watermelons" }
        ];

        let currentVocabList = [];
        let currentModeType = ""; // 'spelling' or 'choice'
        
        // ç·´ç¿’è®Šæ•¸
        let studyIdx = 0;
        let isFlipped = false;

        // è€ƒè©¦è®Šæ•¸
        let quizQueue = [];     
        let quizIndex = 0;      
        let quizScore = 0;
        let isQuizFinished = false;
        let canClick = true; 
        let hintsRemaining = 5;
        let isHintUsedThisQuestion = false;

        window.onload = function() { changeCategory(); };

        // --- åˆ‡æ›é¡Œåº«èˆ‡è€ƒè©¦é¡å‹ ---
        function changeCategory() {
            const selector = document.getElementById('category-select');
            const choice = selector.value;
            
            if (choice === 'week10_17') {
                currentVocabList = db_week10_17;
                currentModeType = 'choice'; // è¨­å®šç‚ºé¸æ“‡é¡Œ
            } else if (choice === 'food_fruit') {
                currentVocabList = db_food_fruit;
                currentModeType = 'spelling'; // è¨­å®šç‚ºæ‹¼å­—
            }

            // é‡ç½®ç·´ç¿’
            studyIdx = 0;
            isFlipped = false;
            document.getElementById('total-words').innerText = currentVocabList.length;
            updateStudyCard();
            
            // å¦‚æœåœ¨è€ƒè©¦ä¸­ï¼Œé‡ç½®è€ƒè©¦
            if (!document.getElementById('quiz-area').classList.contains('hidden')) {
                startNewQuizRound();
            }
        }

        // --- æ¨¡å¼åˆ‡æ› (ç·´ç¿’/è€ƒè©¦) ---
        function setMode(mode) {
            document.getElementById('study-area').classList.toggle('hidden', mode !== 'study');
            document.getElementById('quiz-area').classList.toggle('hidden', mode !== 'quiz');
            document.getElementById('btn-study').classList.toggle('active', mode === 'study');
            document.getElementById('btn-quiz').classList.toggle('active', mode === 'quiz');
            
            if(mode === 'quiz') {
                if (quizQueue.length === 0 || isQuizFinished) {
                    startNewQuizRound();
                } else if (currentModeType === 'spelling') {
                    document.getElementById('answer-input').focus();
                }
            }
        }

        // --- ç™¼éŸ³ ---
        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US'; 
                utterance.rate = 0.8;
                window.speechSynthesis.speak(utterance);
            }
        }
        function speakCurrentWord() { speak(currentVocabList[studyIdx].en); }

        // --- ç·´ç¿’æ¨¡å¼ ---
        function updateStudyCard() {
            const card = document.getElementById('flashcard');
            card.innerText = currentVocabList[studyIdx].ch;
            card.style.background = '#ffeb3b'; 
            isFlipped = false;
            document.getElementById('current-word-num').innerText = studyIdx + 1;
        }

        function flipCard() {
            const card = document.getElementById('flashcard');
            if (isFlipped) {
                card.innerText = currentVocabList[studyIdx].ch;
                card.style.background = '#ffeb3b';
            } else {
                card.innerText = currentVocabList[studyIdx].en;
                card.style.background = '#fff9c4'; 
            }
            isFlipped = !isFlipped;
        }
        function nextCard() { studyIdx = (studyIdx + 1) % currentVocabList.length; updateStudyCard(); }
        function prevCard() { studyIdx = (studyIdx - 1 + currentVocabList.length) % currentVocabList.length; updateStudyCard(); }

        // --- è€ƒè©¦æ¨¡å¼æ ¸å¿ƒ ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startNewQuizRound() {
            document.getElementById('quiz-result').classList.add('hidden');
            document.getElementById('quiz-playing').classList.remove('hidden');

            let shuffled = shuffleArray([...currentVocabList]); 
            const quizLength = Math.min(10, shuffled.length);
            quizQueue = shuffled.slice(0, quizLength); 

            quizIndex = 0;
            quizScore = 0;
            isQuizFinished = false;
            canClick = true;
            hintsRemaining = 5; // é‡ç½®æ‹¼å­—æç¤ºæ¬¡æ•¸

            document.getElementById('q-total').innerText = quizLength;
            
            // æ ¹æ“šé¡å‹åˆ‡æ›ä»‹é¢
            const uiSpelling = document.getElementById('ui-spelling');
            const uiChoice = document.getElementById('ui-choice');

            if (currentModeType === 'spelling') {
                uiSpelling.classList.remove('hidden');
                uiChoice.classList.add('hidden');
            } else {
                uiSpelling.classList.add('hidden');
                uiChoice.classList.remove('hidden');
            }

            updateQuizUI();
            showQuizQuestion();
        }

        function showQuizQuestion() {
            const currentWord = quizQueue[quizIndex];
            document.getElementById('quiz-question').innerText = currentWord.ch;
            document.getElementById('feedback').innerText = '';
            
            if (currentModeType === 'spelling') {
                // æ‹¼å­—æ¨¡å¼è¨­å®š
                document.getElementById('answer-input').value = '';
                document.getElementById('hint-display').innerText = '';
                document.getElementById('answer-input').focus();
                isHintUsedThisQuestion = false;
                updateHintButtonState();
            } else {
                // é¸æ“‡é¡Œæ¨¡å¼è¨­å®š
                canClick = true;
                generateChoiceButtons(currentWord);
            }
            
            updateQuizUI();
        }

        // --- æ‹¼å­—é‚è¼¯ ---
        function checkSpellingAnswer() {
            if (isQuizFinished) return;
            const userAns = document.getElementById('answer-input').value.trim();
            const feedback = document.getElementById('feedback');
            const currentWord = quizQueue[quizIndex];
            
            if (!userAns) return; 

            if (userAns.toLowerCase() === currentWord.en.toLowerCase()) {
                feedback.innerText = "Correct! âœ…";
                feedback.className = "feedback correct-text";
                quizScore += 10;
                speak(currentWord.en);
                setTimeout(nextQuestion, 1200);
            } else {
                feedback.innerText = `Oops! ç­”æ¡ˆæ˜¯: ${currentWord.en}`;
                feedback.className = "feedback wrong-text";
                setTimeout(nextQuestion, 2000);
            }
        }

        function useHint() {
            if (hintsRemaining > 0 && !isHintUsedThisQuestion) {
                hintsRemaining--; 
                isHintUsedThisQuestion = true; 
                const word = quizQueue[quizIndex].en;
                let hintText = word.length <= 2 ? word : `${word.charAt(0)} ... ${word.charAt(word.length - 1)}`;
                document.getElementById('hint-display').innerText = `æç¤º: ${hintText}`;
                updateHintButtonState(); 
                document.getElementById('answer-input').focus();
            }
        }
        function updateHintButtonState() {
            const btn = document.getElementById('btn-hint');
            if (hintsRemaining <= 0 || isHintUsedThisQuestion) {
                btn.disabled = true;
                btn.innerText = hintsRemaining <= 0 ? "ğŸ’¡ æç¤º (å·²ç”¨å®Œ)" : "ğŸ’¡ æç¤º (å·²é¡¯ç¤º)";
            } else {
                btn.disabled = false;
                btn.innerText = `ğŸ’¡ æç¤º (å‰©é¤˜: ${hintsRemaining})`;
            }
        }
        
        // æ‹¼å­—æ¨¡å¼æŒ‰ Enter æäº¤
        document.getElementById("answer-input").addEventListener("keypress", function(event) {
            if (event.key === "Enter" && currentModeType === 'spelling') {
                checkSpellingAnswer();
            }
        });

        // --- é¸æ“‡é¡Œé‚è¼¯ ---
        function generateChoiceButtons(currentWord) {
            let options = [currentWord];
            let distractor;
            // æ‰¾ä¸€å€‹ä¸ä¸€æ¨£çš„å–®å­—ç•¶å¹²æ“¾é …
            do {
                const randIdx = Math.floor(Math.random() * currentVocabList.length);
                distractor = currentVocabList[randIdx];
            } while (distractor.en === currentWord.en);
            options.push(distractor);
            options = shuffleArray(options);

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt.en;
                btn.onclick = () => checkChoice(btn, opt.en, currentWord.en);
                container.appendChild(btn);
            });
        }

        function checkChoice(btnElement, selectedEn, correctEn) {
            if (!canClick) return; 
            canClick = false;
            const feedback = document.getElementById('feedback');
            
            if (selectedEn === correctEn) {
                btnElement.classList.add('correct'); 
                feedback.innerText = "Correct! âœ…";
                feedback.className = "feedback correct-text";
                quizScore += 10;
                speak(correctEn);
                setTimeout(nextQuestion, 1000); 
            } else {
                btnElement.classList.add('wrong'); 
                feedback.innerText = `Oops! ç­”æ¡ˆæ˜¯: ${correctEn}`;
                feedback.className = "feedback wrong-text";
                // æ¨™ç¤ºæ­£ç¢ºç­”æ¡ˆ
                document.querySelectorAll('.option-btn').forEach(b => {
                    if (b.innerText === correctEn) b.classList.add('correct');
                });
                speak(correctEn); 
                setTimeout(nextQuestion, 2000); 
            }
        }

        function updateQuizUI() {
            document.getElementById('q-progress').innerText = quizIndex + 1;
            document.getElementById('score').innerText = quizScore;
        }

        function nextQuestion() {
            quizIndex++;
            if (quizIndex < quizQueue.length) {
                showQuizQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            isQuizFinished = true;
            document.getElementById('quiz-playing').classList.add('hidden');
            document.getElementById('quiz-result').classList.remove('hidden');
            
            const maxScore = quizQueue.length * 10;
            document.getElementById('final-score').innerText = `${quizScore} / ${maxScore}`;
            
            const comment = document.getElementById('comment');
            if (quizScore === maxScore) comment.innerText = "å¤ªç¥å•¦ï¼å…¨å°ï¼ğŸŒŸ";
            else if (quizScore >= maxScore * 0.8) comment.innerText = "å¾ˆæ£’å–”ï¼ç¹¼çºŒä¿æŒï¼ğŸ‘";
            else if (quizScore >= maxScore * 0.6) comment.innerText = "åŠæ ¼äº†ï¼Œå†æ¥å†å²ï¼ğŸ’ª";
            else comment.innerText = "æ²’é—œä¿‚ï¼Œå¤šç©å¹¾æ¬¡å°±æœƒäº†ï¼ğŸ”¥";
        }
    </script>
</body>
</html>
